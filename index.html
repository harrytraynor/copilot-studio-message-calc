<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Copilot Studio Message Cost & Agent Builder</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Copilot Studio - Message Cost & Agent Builder</h1>
        <div class="sub">Compare PAYG vs Packs, or model an agent to auto-populate volumes. Prices are ex-VAT.</div>
      </div>
    </header>

    <nav class="tabs" role="tablist" aria-label="Views">
      <button class="tab" role="tab" id="tab-calc" aria-controls="view-calc" aria-selected="true">Calculator</button>
      <button class="tab" role="tab" id="tab-flow" aria-controls="view-flow" aria-selected="false">Agent Builder</button>
    </nav>

    <!-- CALCULATOR VIEW -->
    <section id="view-calc" role="tabpanel" aria-labelledby="tab-calc">
      <div class="grid">
        <!-- Inputs -->
        <section class="card" aria-labelledby="inputs">
          <h2 id="inputs">Inputs</h2>
          <div class="row">
            <div>
              <label for="messages">Projected messages (per month)</label>
              <input id="messages" type="number" inputmode="numeric" min="0" step="1" value="50000" />
            </div>
            <div>
              <label for="buffer">Buffer (%)</label>
              <input id="buffer" type="number" inputmode="decimal" min="0" step="1" value="20" />
            </div>
            <div class="full">
              <div class="switch"><input id="vat" type="checkbox" /><label for="vat">Include VAT (20%)</label></div>
              <div class="switch" style="margin-top:8px"><input id="m365Apply" type="checkbox" /><label for="m365Apply">Apply Microsoft 365 Copilot licensing to results</label></div>
            </div>
          </div>

          <details>
            <summary>Advanced pricing (edit if needed)</summary>
            <div class="row" style="margin-top:10px">
              <div>
                <label for="payg">PAYG price per message (&pound;)</label>
                <input id="payg" type="number" inputmode="decimal" min="0" step="0.0001" value="0.008" />
                <div class="hint">Assumes $0.01/msg &asymp; &pound;0.008 after FX.</div>
              </div>
              <div>
                <label for="packPrice">Message pack price (&pound;)</label>
                <input id="packPrice" type="number" inputmode="decimal" min="0" step="0.01" value="153.80" />
              </div>
              <div>
                <label for="packSize">Message pack size</label>
                <input id="packSize" type="number" inputmode="numeric" min="1" step="1" value="25000" />
              </div>
              <div>
                <label for="vatRate">VAT rate (%)</label>
                <input id="vatRate" type="number" inputmode="decimal" min="0" step="0.1" value="20" />
              </div>
            </div>
          </details>

          <div class="result">
            <div>Effective messages incl. buffer</div>
            <strong class="mono" id="effective">0</strong>
          </div>
          <div class="result" id="m365EffWrap" style="display:none">
            <div>Effective billed messages (with M365 Copilot)</div>
            <strong class="mono" id="effectiveM365">0</strong>
          </div>

          <div class="row" style="margin-top:10px">
            <div>
              <label for="totalUsers">Total agent users</label>
              <input id="totalUsers" type="number" inputmode="numeric" min="0" step="1" value="100" />
            </div>
            <div>
              <label for="licensedUsers">Licensed users (M365 Copilot)</label>
              <input id="licensedUsers" type="number" inputmode="numeric" min="0" step="1" value="0" />
            </div>
          </div>
        </section>

        <!-- Outputs -->
        <section class="card" aria-labelledby="outputs">
          <h2 id="outputs">Results</h2>
          <div id="options"></div>

          <div class="recommend" id="recCard">
            <div>
              <h3>Recommendation</h3>
              <div class="muted" id="why">-</div>
            </div>
            <div class="big" id="recommend">-</div>
          </div>

          <div style="margin-top:10px" class="row">
            <div class="full">
              <div class="hint">Breakeven (PAYG vs one pack): <span class="mono" id="breakeven">-</span> messages (VAT cancels).</div>
            </div>
          </div>
        </section>
      </div>

      <footer>
        <p>Assumptions: UK list prices (ex-VAT). PAYG in GBP fluctuates with FX; adjust per-message if needed. Packs are whole-unit (ceil to full packs). "Buffer" multiplies your volume before pricing.</p>
      </footer>
    </section>

    <!-- AGENT BUILDER VIEW -->
    <section id="view-flow" class="hidden" role="tabpanel" aria-labelledby="tab-flow">
      <div class="flow-grid">
        <!-- Canvas -->
        <section class="card">
          <h2>Agent builder</h2>
          <div id="canvas" class="flow-canvas"></div>
          <div class="result">
            <div>Messages per run</div>
            <strong class="mono" id="perRun">0.000</strong>
          </div>
          
        </section>

        <!-- Inspector / Add panel -->
        <section class="card inspector">
          <h2>Inspector</h2>
          <div class="row">
            <div class="full">
              <label for="nodeName">Step name</label>
              <input id="nodeName" type="text" placeholder="e.g., Retrieve policy" />
            </div>
            <div>
              <label for="nodeType">Type</label>
              <select id="nodeType">
                <option value="classic">Classic answer (+1)</option>
                <option value="generative">Generative answer (+2)</option>
                <option value="tenant">Tenant graph grounding (+10)</option>
                <option value="flow">Agent flow (invoke + actions)</option>
                <option value="toolBasic">AI tool - Basic (+0.1 each)</option>
                <option value="toolStandard">AI tool - Standard (+1.5 each)</option>
                <option value="toolPremium">AI tool - Premium (+10 each)</option>
                <option value="web">Web-grounded (0)</option>
              </select>
            </div>
            <div>
              <label for="nodeQty">Quantity</label>
              <input id="nodeQty" type="number" min="1" step="1" value="1" />
            </div>
            <div id="flowActionsWrap" class="full">
              <label for="flowActions">Actions inside flow (per run)</label>
              <input id="flowActions" type="number" min="0" step="1" value="3" />
              <div class="hint">Message calc for flow: <span class="mono">qty x (5 + 0.13 x actions)</span></div>
            </div>
            <div class="full actions">
              <button id="addOrUpdateNode" class="btn primary">Add step</button>
              <button id="duplicateNode" class="btn">Duplicate</button>
              <button id="deleteNode" class="btn" data-action="delete">Delete</button>
              <button id="moveUp" class="btn">Move up</button>
              <button id="moveDown" class="btn">Move down</button>
            </div>
          </div>

          <h2 style="margin-top:14px">Expected volume</h2>
          <div class="row">
            <div class="full">
              <label for="expectedVolume">Expected runs per month</label>
              <input id="expectedVolume" type="number" min="0" step="1" value="1000" />
            </div>
          </div>
          
          <div class="actions" style="margin-top:12px">
            <button id="pushToCalc" class="btn primary">Send to Calculator</button>
          </div>
          <p class="hint" style="margin-top:10px">The agent view auto-syncs the Calculator's messages field.</p>
        </section>
      </div>
    </section>
  </div>

  <script src="app.js"></script>
</body>
</html>
